---
layout : post 
title : hadoop配置
subtitle : hadoop, 配置
date : 2019-1-16
header-img : img/post-bg-2015.jpg
catalog : true
tags : 
	-大数据


---

> 

**1.**  **校准时间**

**2.**  **所有节点设置时区**

timedatectl set-timezone "Asia/Shanghai"

**3.**  **统一时间。****‘****对表****’****，即以主节点时间为准**

**3.1**  **所有机器安装****ntp**

在交互回话中输入:

yum -y install ntp

**3.2**  **修改主节点****hadoop1****配置**

Vi /etc/ntp.conf  (修改如下)

 

\#server 0.centos.pool.ntp.org iburst

\#server 1.centos.pool.ntp.org iburst

\#server 2.centos.pool.ntp.org iburst

\#server 3.centos.pool.ntp.org iburst

server 127.127.1.1

**3.3**  **重启****ntpd** **进程，设置开机自启**

systemctl restart ntpd

systemctl enable ntpd

**4.**  **在其他节点上指定以****hadoop1****为准来进行时间校准**

ntpdate hadoop1

systemctl restart ntpd

crontab 定时执行脚本/命令

**5.**   **修改其他节点的**

Vi /etc/ntp.conf

\#server 0.centos.pool.ntp.org iburst

\#server 1.centos.pool.ntp.org iburst

\#server 2.centos.pool.ntp.org iburst

\#server 3.centos.pool.ntp.org iburst

server 192.168.123.132

 

**2.** **配置****hadoop****环境**

**2.1.** **配置****jdk****环境**

**2.2** **解压****hadoop****文件**

将 targz文件夹下的 hadoop-2.6.0 解压到 programs

tar –zxf hadoop-2.6.0.tar.gz –C /opt/ programs

**2.3** **修改配置文件**

**2.3.1** **配置****jdk****的地址，****etc/hadoop/hadoop-env.sh****文件**

\# set to the root of your Java installation

export JAVA_HOME=/usr/java/jdk1.8.0_25

 

standalone本地运行的操作

$ mkdir input

$ cp etc/hadoop/*.xml input

$ bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce- examples-2.6.0.jar wordcountinput output

$ cat output/*

出现文件的次数说明配置成功

**2.3.2** **配置****hdfs****，namenode**

**etc/hadoop/core-site.xml****文件**

新建文件夹data/tmp,用来存放临时文件

$ mkdir –p data/tmp (-p 创建目录树)

$ etc/hadoop/core-site.xml

<configuration>

​        <property>

​        <name>fs.defaultFS</name>

​        <value>hdfs://hadoop1:9000</value>

​        </property>

​        <property>

​        <name>hadoop.tmp.dir</name>

​        <value>/opt/programs/hadoop-2.6.0/data/tmp</value>

​        </property>

</configuration>

$ vi etc/hadoop/hdfs-site.xml (配置副本数)

<configuration>

​        <property>

​                <name>dfs.replication</name>

​                <value>1</value>

​        </property>

​        <property>

​                <name>dfs.permissions</name>

​                <value>false</value>

​        </property>

​        <property>

​                <name>dfs.namenode.secondary.http-address</name>

​                <value>hadoop1:50090</value>

​        </property>

</configuration>

首次启动，namenode需要格式化

​       在/opt/programs/hadoop-2.6.0里面 bin/hadoop namenode -format

​       监控端口是50070

​       启动namenode，datanode

​       hadoop-daemon.sh start namenode

​       hadoop-daemon.sh start datanode

​       可以在/opt/programs/hadoop-2.6.0/sbin ./hadoop-daemon.sh start namenode

配置环境变量

创建test文件夹存放文件

$ bin/hdfs dfs -mkdir /test

$ bin/hdfs dfs -ls /

 

测试

​       bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.6.0.jar wordcount /test/ /ouput9/

打开浏览器输入网址 hadoop1:50070查看文件

 

配置historyserver

$ vi etc/hadoop/mapred-site.xml

<property>

  <name>mapreduce.jobhistory.address</name>

  <value>hadoop1:10020</value>

</property>

<property>

  <name>mapreduce.jobhistory.webapp.address</name>

  <value>hadoop1:19888</value>

</property>

启动historyserver：

sbin/mr-jobhistory-daemon.sh start historyserver

**2.3.3** **配置****yarn,**

打开/opt/programs/hadoop-2.6.0/etc/hadoop

​       把里面的改名  mv mapred-site.xml.template mapred-site.xml

​       打开文件

​       <configuration>

​           <property>

​                      <name>mapreduce.framework.name</name>

​                      <value>yarn</value>

​           </property>

​       </configuration>

​       打开文件yarn-site.xml

​       <configuration>

​              <!-- Site specific YARN configuration properties -->

​           <property>

​                    <name>yarn.nodemanager.aux-services</name>

​                          <value>mapreduce_shuffle</value>

​           </property>

​                   <property>

​                      <name>yarn.resourcemanager.hostname</name>

​                      <value>hadoop1</value>

​           </property>

​       </configuration>

​       在/opt/programs/hadoop-2.6.0/sbin 里面./startyarn.sh

​       测试

​       bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.6.0.jar wordcount /test/ /test5/

配置日志功能开启:

$ vi etc/hadoop/yarn-site.xml

<property>

  <name>yarn.log-aggregation-enable</name>

  <value>true</value>

</property>

<property>

  <name>yarn.log-aggregation.retain-seconds</name>

  <value>640800</value>

</property>

重启JobHistoryServer：

进入sbin文件夹,启动start-yarn.sh文件:

./ stop-yarn.sh

./ start-yarn.sh

测试日志，查看页面

bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.6.0.jar wordcount /test/ /ouput9/

如果还不行，关闭重启historyserver，或者关闭重启所有相关进程.

 
